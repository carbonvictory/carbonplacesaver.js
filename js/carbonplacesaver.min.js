(function(b){b.fn.carbonPlacesaver=function(c){var d=b.extend({},b.fn.carbonPlacesaver.defaultSettings,c||{});var e=new a(d,this);e.resumeReading();return this.bind("scroll",function(){e.savePlace();if(e.isDoneReading()){e.endReading();}});};b.fn.carbonPlacesaver.defaultSettings={uniquePageKey:window.location.pathname.replace(/[^\w]/g,""),sensitivity:100,scrollSpeed:"slow",duration:2,clearOnFinish:true,clearElement:null};function a(d,c){this.settings=d;this.context=c;this.documentHeight=b(document).height();this.useLocalStorage=(typeof(localStorage)!=="undefined")?true:false;this.currentScrollPosition=null;return this;}a.prototype={resumeReading:function(){var c=(this.useLocalStorage)?localStorage.getItem(this.settings.uniquePageKey):b.cookie(this.settings.uniquePageKey);if(c!=null){b("html, body").animate({scrollTop:c},this.settings.scrollSpeed);this.currentScrollPosition=c;}else{this.currentScrollPosition=0;}},savePlace:function(){var c=b(this.context).scrollTop();if(c-this.currentScrollPosition>=this.settings.sensitivity){if(this.useLocalStorage){localStorage.setItem(this.settings.uniquePageKey,c);}else{b.cookie(this.settings.uniquePageKey,c,{expires:this.settings.duration});}}},isDoneReading:function(){if(this.settings.clearOnFinish==true){var f=b(this.context).scrollTop();var c=f+b(this.context).height();if(this.settings.clearElement!=null){var d=b(this.settings.clearElement).offset().top;var e=d+b(this.settings.clearElement).height();return((e>=f)&&(d<=c)&&(e<=c)&&(d>=f));}return(c>=this.documentHeight);}return false;},endReading:function(){this.currentScrollPosition=null;b(this.context).unbind("scroll");if(this.useLocalStorage){localStorage.removeItem(this.settings.uniquePageKey);}else{b.cookie(this.settings.uniquePageKey,null);}}};})(jQuery);